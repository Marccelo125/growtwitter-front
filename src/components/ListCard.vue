<script setup lang="ts">
import { defineProps, computed } from 'vue';
import type { TweetType } from '@/types';
import CardTweet from './CardTweet.vue';
import CardRetweet from './CardRetweet.vue';
import { useRoute } from 'vue-router';

interface Props {
  tweets: TweetType[];
  retweets: any[];
  profile?: boolean;
}

const listCardEmits = defineEmits(['passForList']);

const props = defineProps<Props>();

const combinedList = computed(() => {
  const formattedTweets = props.tweets.map((tweet) => ({
    ...tweet,
    type: 'tweet',
    createdAt: new Date(tweet.created_at)
  }));

  const formattedRetweets = props.retweets.map((retweet) => ({
    ...retweet,
    type: 'retweet',
    createdAt: new Date(retweet.created_at)
  }));

  return [...formattedTweets, ...formattedRetweets].sort((a, b) => b.createdAt - a.createdAt);
});

const route = useRoute();

const filteredList = computed(() => {
  if (!props.profile) {
    return combinedList.value;
  }
  const filtered = combinedList.value.filter((item) => item.userId === Number(route.params.id));

  return filtered;
});
</script>

<template>
  <div class="pt-4">
    <p>LITAGEM:</p>
    <div v-for="item in filteredList" :key="item.id">
      <CardRetweet v-if="item.type === 'retweet'" :data="item" :tweet="props.tweets.find((tweet) => tweet.id == item.postId)" @reloadHome="listCardEmits('passForList')" />
      <div v-else>
        <CardTweet v-if="profile" :data="item" :yourProfile="true" @reloadHome="listCardEmits('passForList')" />
        <CardTweet v-else :data="item" @reloadHome="listCardEmits('passForList')" />
      </div>
    </div>
  </div>
</template>
